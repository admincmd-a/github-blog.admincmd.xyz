// 主 JS 文件
/*
*/

// 往控制台里写点东西
console.log('Hello,Hello,Hello,Hello,Hello,Hello,Hello,Hello,Hello,Hello,Hello,Hello,Hello,Hello,Hello,Hello,Hello,Hello,Hello,Hello,Hello,Hello,Hello,Hello,');
// 十分的胜景，害的我笑了一下
console.log(`
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
.....................@@@@..................@@@..........................@@@@..............................@@@@@..................................@@@...............
.....................@@@@..................@@@..........................@@@@............................@@@@@@@@@................................@@@...............
.....................@@@@..................@@@..........................@@@@...........................@@@@@@@@@@@...............................@@@...............
....................@@@@@@.................@@@..........................@@@@...........................@@@@@.@@@@@...............................@@@...............
....................@@@@@@.................@@@..........................@@@@..........................@@@@.....@@@@..............................@@@...............
....................@@@@@@.................@@@........................................................@@@@.....@@@@..............................@@@...............
...................@@@@@@@@................@@@........................................................@@@@.....@@@@..............................@@@...............
...................@@@@@@@@.........@@@@@@.@@@...@@@@@@@@@.@@@@.........@@@@.........@@@.@@@@@@......@@@@......@@@@..@@@@@@@@@.@@@@.......@@@@@@.@@@...............
...................@@@@.@@@........@@@@@@@@@@@...@@@@@@@@@@@@@@@........@@@@.........@@@@@@@@@@@.....@@@@......@@@@..@@@@@@@@@@@@@@@.....@@@@@@@@@@@...............
...................@@@..@@@.......@@@@@@@@@@@@...@@@@@@@@@@@@@@@........@@@@.........@@@@@@@@@@@@....@@@@............@@@@@@@@@@@@@@@....@@@@@@@@@@@@...............
..................@@@@..@@@@......@@@@...@@@@@...@@@@@.@@@@@.@@@@.......@@@@.........@@@@@...@@@@....@@@@............@@@@@.@@@@@.@@@@...@@@@...@@@@@...............
..................@@@@..@@@@.....@@@@.....@@@@...@@@@..@@@@..@@@@.......@@@@.........@@@@.....@@@....@@@@............@@@@..@@@@..@@@@..@@@@.....@@@@...............
..................@@@@@@@@@@.....@@@@.....@@@@...@@@@..@@@@..@@@@.......@@@@.........@@@@.....@@@....@@@@......@@@@..@@@@..@@@@..@@@@..@@@@.....@@@@...............
.................@@@@@@@@@@@@....@@@@......@@@...@@@@..@@@@..@@@@.......@@@@.........@@@......@@@....@@@@......@@@@..@@@@..@@@@..@@@@..@@@@......@@@...............
.................@@@@@@@@@@@@....@@@@......@@@...@@@@..@@@@..@@@@.......@@@@.........@@@......@@@....@@@@......@@@@..@@@@..@@@@..@@@@..@@@@......@@@...............
.................@@@@....@@@@....@@@@.....@@@@...@@@@..@@@@..@@@@.......@@@@.........@@@......@@@....@@@@@.....@@@@..@@@@..@@@@..@@@@..@@@@.....@@@@...............
.................@@@@....@@@@....@@@@.....@@@@...@@@@..@@@@..@@@@.......@@@@.........@@@......@@@.....@@@@.....@@@@..@@@@..@@@@..@@@@..@@@@.....@@@@...............
................@@@@......@@@@....@@@@...@@@@@...@@@@..@@@@..@@@@.......@@@@.........@@@......@@@.....@@@@@...@@@@...@@@@..@@@@..@@@@...@@@@...@@@@@...............
................@@@@......@@@@....@@@@@@@@@@@@...@@@@..@@@@..@@@@.......@@@@.........@@@......@@@......@@@@@@@@@@@...@@@@..@@@@..@@@@...@@@@@@@@@@@@...............
................@@@@......@@@@.....@@@@@@@@@@@...@@@@..@@@@..@@@@.......@@@@.........@@@......@@@......@@@@@@@@@@....@@@@..@@@@..@@@@....@@@@@@@@@@@...............
...............@@@@@.......@@@@.....@@@@@@@@@@...@@@@..@@@@..@@@@.......@@@@.........@@@......@@@........@@@@@@@.....@@@@..@@@@..@@@@.....@@@@@@@@@@...............
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
...................................................................................................................................................................
`)
   

// document.getElementById("aplayer").innerHTML = `
// <!--<div id="aplayer"></div>-->
// <link href="https://files.cnblogs.com/files/shwee/APlayer.min_v1.10.1.css" rel="stylesheet">
// <script src="https://files.cnblogs.com/files/shwee/APlayer.min_v1.10.1.js"></script>
 
// <script type="text/javascript">
// const ap = new APlayer({
//     container: document.getElementById('aplayer'),
//     fixed: true,
//     autoplay: true, //自动播放
//     audio: [{
//             name: "愿爱无忧",
//             artist: "恩几",
//             url: "http://ws.stream.qqmusic.qq.com/C400002XALjh4VMGdC.m4a?guid=877697360&vkey=14BB55BBF2631E5ECF25047DB9ED0BD0B05872634F2203AA509BE64952FF893DE096CCC04C8EFA1CEAEA292799BFBCD5DD2522EF90D3155D&uin=&fromtag=120032",
//             cover: "",
//             lrc: "[[ti:愿爱无忧 (Live)][ar:恩几][al:][by:][offset:0][00:00.00]愿爱无忧 (Live) - 恩几[00:00.23]词：高虎[00:00.33]曲：高虎[00:00.63]像是写给爱人的歌[00:03.73][00:05.97]四目相对 从那一刻[00:09.14][00:11.79]在有爱的早上[00:14.47]带上神的孩子[00:16.59]直到我们明天一起醒来[00:21.15][00:22.30]不要怀疑懵懂的双眼[00:26.92][00:27.77]不要怀疑心醉的誓言[00:32.39][00:33.22]从习惯的见面[00:36.00]摆一摆手又说再见[00:38.22]再见分别 又像昨天[00:43.04][00:44.02]愿爱无忧[00:48.78][00:49.30]愿爱无忧]"
 
//         },
//         {
//             name: '停在昨天',
//             artist: '乔洋',
//             url: 'http://music.163.com/song/media/outer/url?id=26600249.mp3',
//             cover: 'https://p2.music.126.net/cRTH7MeN3ySpQJKcbqoczg==/2313372464905466.jpg?param=130y130',
//             lrc: '[[00:00.02]被伤的感情要怎么样平静[00:07.78]我独自呆在回忆里的风景[00:13.77]听说爱情就像易碎的水晶[00:20.52]我用心呵护这段感情[00:26.58]把一切感人的话说干说净[00:33.27]得到的只是冷漠一声回应[00:39.40]也许你在装着嘴硬压抑心情[00:45.91]可是我早以无法倾听[00:51.97]我们要走得很远[00:54.97]要幸福直到终点[00:58.21]你怎么没看清我泪湿的脸[01:04.58]那一些伤害都是我们多余的画面[01:11.65]才不愿看你离开身边[01:17.37]多想要停在昨天[01:20.50]停在单纯的从前[01:23.68]那个我触手可见清晰的脸[01:29.99]让时间停在你我还关心彼此瞬间[01:37.25]我不愿从此看你不见[01:42.19]停在 昨天[01:45.83][01:54.32][02:01.32][02:07.00][02:09.32]把一切感人的话说干说净[02:15.46]得到的只是冷漠一声回应[02:21.59]也许你在装着嘴硬压抑心情[02:28.27]可是我早以无法倾听[02:34.09]我们要走得很远[02:37.15]要幸福直到终点[02:40.46]你怎么没看清我泪湿的脸[02:46.78]那一些伤害都是我们多余的画面[02:53.90]才不愿看你离开身边[02:59.78]多想要停在昨天[03:02.71]停在单纯的从前[03:06.02]那个我触手可见清晰的脸[03:12.40]让时间停在你我还关心彼此瞬间[03:19.53]我不愿从此看你不见[03:24.47]停在 昨天[03:28.50]要幸福直到终点[03:31.56]你怎么没看清我泪湿的脸[03:38.26]那一些伤害都是我们多余的画面[03:44.88]才不愿看你离开身边[03:50.73]多想要停在昨天[03:53.79]停在单纯的从前[03:57.10]那个我触手可见清晰的脸[04:03.97]让时间停在你我还关心彼此瞬间[04:10.47]我不愿从此看你不见[04:15.41]停在 昨天]'
//         },
 
// 	]
// });
// ap.init();
// </script>
// `;


// ----------------------
// HTTP透明端口转发：80 8080 8880 2052 2082 2086 2095
// HTTPS隧道端口转发：443 2053 2083 2087 2096 8443
// HTTP/HTTPS端口隧道转发，但以下端口禁用CDN缓存：2052 2053 2082 2083 2086 2087 2095 2096 8880 8443

// 找到所有具有 "post" 的 ID 的链接
// const links = document.querySelectorAll('a[id^="post"]');

// 遍历每一个链接并修改其 href
// links.forEach(link => {
//     link.href = "https://blog.admincmd.xyz/url.html?url=" + encodeURIComponent(link.href);
// });

function NewURLWindows(url,title){
    new WinBox.js({
        url: url,
        title: title,
    })
}

function NewWindowsSetting(){
    new WinBox.js({
        url: "https://blog.admincmd.xyz/page/setting.html",
        title: "设置",
})
}



// 用户跳过来弄过去改下标题
// 修改标题
document.addEventListener('DOMContentLoaded', (event) => {
    originalTitle = document.title; // 记录初始标题
    lostFocusTitle = `这都跑去干啥了？ 让我康康 | ${originalTitle}`; // 页面失去焦点时的标题
    gainedFocusTitle = `干啥去了，现在才回来……  | ${originalTitle}`; // 页面获得焦点时的标题

    // 监听页面失去焦点和获得焦点事件
    document.addEventListener('visibilitychange', () => {
        try {
            //if (shouldExclude) return; // 如果 URL 在排除列表中，则直接返回
            
            if (document.hidden) {
                // 页面失去焦点
                if (document.title !== '页面没有找到 | 管理员 - 命令提示符') {
                    document.title = lostFocusTitle; // 更改标题
                }
            } else {
                // 页面获得焦点
                document.title = gainedFocusTitle; // 更改标题
                setTimeout(() => {
                    if (!document.hidden) {
                        document.title = originalTitle; // 改回来
                    }
                }, 2000); // 等待2秒
            }
        } catch (error) {
            console.error('标题更改过程中出错:', error);
        }
    });
});


// 欢迎语，cookie 提醒 --------------------------------------------
// 首次访问，弹出Cookie提醒
welcometxmap()

// 以下是欢迎语
// ----------------------------------
function welcometxmap() {
    //请求数据
    ipLoacation = window.saveToLocal.get('ipLocation');
    if (ipLoacation) {
        // 使用 ipLocation
    } else {
        // 数据已过期或不存在
        var txkey = 'ET6BZ-DDXEN-JRBFT-SZEUP-WBLXS-V7FGJ';
        // ttttttttttttttttttt
        var script = document.createElement('script');
        var url = `https://apis.map.qq.com/ws/location/v1/ip?key=${txkey}&output=jsonp`;
        script.src = url;
        window.QQmap = function (data) {
            ipLoacation = data;
            // 将数据保存到 localStorage，过期时间设置为 1 天
            window.saveToLocal.set('ipLocation', ipLoacation, 1);
            document.body.removeChild(script);
            delete window.QQmap;
        };
        document.body.appendChild(script);
    }
    showWelcome();
}
function getDistance(e1, n1, e2, n2) {
    const R = 6371
    const { sin, cos, asin, PI, hypot } = Math
    let getPoint = (e, n) => {
        e *= PI / 180
        n *= PI / 180
        return { x: cos(n) * cos(e), y: cos(n) * sin(e), z: sin(n) }
    }

    let a = getPoint(e1, n1)
    let b = getPoint(e2, n2)
    let c = hypot(a.x - b.x, a.y - b.y, a.z - b.z)
    let r = asin(c / 2) * 2 * R
    return Math.round(r);
}

function showWelcome() {

    let dist = getDistance(114.305000, 30.592800, ipLoacation.result.location.lng, ipLoacation.result.location.lat);
    let pos = ipLoacation.result.ad_info.nation;
    let ip = ipLoacation.result.ip;
    let ipDZ;
    let posdesc;//要显示的信息

    //根据国家、省份、城市信息自定义欢迎语
    //海外地区不支持省份及城市信息
    switch (ipLoacation.result.ad_info.nation) {
        case "日本":
            posdesc = "よろしく，一起去看樱花吗";
            break;
        case "美国":
            posdesc = "Make America Great Again!";
            break;
        case "英国":
            posdesc = "想同你一起夜乘伦敦眼";
            break;
        case "俄罗斯":
            posdesc = "干了这瓶伏特加！";
            break;
        case "法国":
            posdesc = "C'est La Vie";
            break;
        case "德国":
            posdesc = "Die Zeit verging im Fluge.";
            break;
        case "澳大利亚":
            posdesc = "一起去大堡礁吧！";
            break;
        case "加拿大":
            posdesc = "拾起一片枫叶赠予你";
            break;
        case "南极洲":
            posdesc = "南极洲的风很大，你一定记得要带伞！";
            break;
        case "巴西":
            posdesc = "巴西足球";
            break;
        case "加拿大":
            posdesc = "加拿大不大";
            break;
        case "中国":
            pos = ipLoacation.result.ad_info.province + " " + ipLoacation.result.ad_info.city;
            switch (ipLoacation.result.ad_info.province) {
                case "北京市":
                    pos = "北京市";
                    posdesc = "北——京——欢迎你~~~";
                    break;
                case "天津市":
                    pos = "天津市";
                    posdesc = "讲段相声吧。";
                    break;
                case "重庆市":
                    pos = "重庆市";
                    posdesc = "高德地图:已到达重庆，下面切换百度地图导航。百度地图：已到达重庆，下面切换高德地图导航。"
                    break;
                case "河北省":
                    posdesc = "山势巍巍成壁垒，天下雄关。铁马金戈由此向，无限江山。";
                    break;
                case "山西省":
                    posdesc = "展开坐具长三尺，已占山河五百余。";
                    break;
                case "内蒙古自治区":
                    posdesc = "天苍苍，野茫茫，风吹草低见牛羊。";
                    break;
                case "辽宁省":
                    posdesc = "我想吃烤鸡架！";
                    break;
                case "吉林省":
                    posdesc = "状元阁就是东北烧烤之王。";
                    break;
                case "黑龙江省":
                    posdesc = "哈尔滨红肠,东北饺子";
                    break;
                case "上海市":
                    pos = "上海市";
                    posdesc = "众所周知，中国只有 3 个城市。";
                    break;
                case "江苏省":
                    switch (ipLoacation.result.ad_info.city) {
                        case "南京市":
                            posdesc = "欢迎来自安徽省南京市的小伙伴。";
                            break;
                        case "苏州市":
                            posdesc = "上有天堂，下有苏杭。";
                            break;
                        default:
                            posdesc = "散装是必须要散装的。";
                            break;
                    }
                    break;
                case "浙江省":
                    posdesc = "东风渐绿西湖柳，雁已还人未南归。";
                    break;
                case "安徽省":
                    posdesc = "蚌埠住了，芜湖起飞。";
                    break;
                case "福建省":
                    posdesc = "井邑白云间，岩城远带山。";
                    break;
                case "江西省":
                    posdesc = "落霞与孤鹜齐飞，秋水共长天一色。";
                    break;
                case "山东省":
                    posdesc = "遥望齐州九点烟，一泓海水杯中泻。";
                break;
                case "湖北省":
                switch (ipLoacation.result.ad_info.city) {
                    case "武汉市":
                        posdesc = "哟，我也住在武汉市。大江大河大武汉，走，吃热干面去！";
                        break;
                    case "咸宁市":
                        posdesc = "我老家在咸宁。";
                        break;
                    default:
                        posdesc = "老板，来碗热干面！";
                        break;
                }
                    break;
                case "湖南省":
                    posdesc = "74751，长沙斯塔克。";
                    break;
                case "广东省":
                    posdesc = "老板来两斤福建人。";
                    break;
                case "广西壮族自治区":
                    posdesc = "桂林山水甲天下。";
                    break;
                case "海南省":
                    posdesc = "朝观日出逐白浪，夕看云起收霞光。";
                    break;
                case "四川省":
                    posdesc = "康康川妹子。";
                    break;
                case "贵州省":
                    posdesc = "茅台，学生，再塞200。";
                    break;
                case "云南省":
                    posdesc = "玉龙飞舞云缠绕，万仞冰川直耸天。";
                    break;
                case "西藏自治区":
                    posdesc = "躺在茫茫草原上，仰望蓝天。";
                    break;
                case "陕西省":
                    posdesc = "来份臊子面加馍。";
                    break;
                case "甘肃省":
                    posdesc = "羌笛何须怨杨柳，春风不度玉门关。";
                    break;
                case "青海省":
                    posdesc = "牛肉干和老酸奶都好好吃。";
                    break;
                case "宁夏回族自治区":
                    posdesc = "大漠孤烟直，长河落日圆。";
                    break;
                case "新疆维吾尔自治区":
                    posdesc = "驼铃古道丝绸路，胡马犹闻唐汉风。";
                    break;
                case "台湾省":
                    posdesc = "我在这头，大陆在那头。";
                    break;
                case "香港特别行政区":
                    pos = "香港特别行政区";
                    posdesc = "永定贼有残留地鬼嚎，迎击光非岁玉。";
                    break;
                case "澳门特别行政区":
                    pos = "澳门特别行政区";
                    posdesc = "性感荷官，在线发牌。";
                    break;
                default:
                    posdesc = "社会主义大法好。";
                    break;
            }
            break;
        default:
            posdesc = "带我去你的国家逛逛吧。";
            break;
    }

    //判断时间
    let timeChange;
    let date = new Date();
    if (date.getHours()>= 5 && date.getHours() < 11) timeChange = "<span>上午好</span>，一日之计在于晨";
    else if (date.getHours()>= 1 && date.getHours() < 13) timeChange = "<span>中午好</span>，开——饭——了——";
    else if (date.getHours() >= 13 && date.getHours() < 15) timeChange = "<span>下午好</span>，懒懒地睡个午觉吧！";
    else if (date.getHours() >= 15 && date.getHours() < 16) timeChange = "<span>下午三点了</span>，上课摸鱼 ING...";
    else if (date.getHours() >= 16 && date.getHours() < 19) timeChange = "<span>夕阳无限好！</span>";
    else if (date.getHours() >= 19 && date.getHours() < 24) timeChange = "<span>晚上好</span>，我要写作业了……";
    else timeChange = "都几点了，还在熬夜？";



    //自定义文本需要放的位置
    document.getElementById("welcome-info").innerHTML = `欢迎来自<span>${pos}</span>的小伙伴，${timeChange}<br>你距我约有<span>${dist}</span>公里，${posdesc}，您的 IP 地址是 ${ip}`;

    if (sessionStorage.getItem("popCookieWindow") != "0") {
        setTimeout(function () {
            Snackbar.show({
                text: 'INFO 本站使用 Cookie 和本地 会话存储 保证浏览体验和网站统计',
                pos: 'top-right',
                actionText: "查看博客声明",
                onActionClick: function (element) {
                    window.open("/license")
                },
            })
        }, 3500)
    }
    //不在弹出Cookie提醒
    sessionStorage.setItem("popCookieWindow", "0");
    
    
    let referrer = document.referrer || ' ? ? ? ';
    let domain = referrer ? referrer.split("://")[1] : ' ? ? ? ';
    domain = domain ? domain.split("/")[0] : ' ? ? ? ';

    setTimeout(function () { // 康康是不是来自其他网站
        if(domain=='blog.admincmd.xyz') {
            console.log('由本站主站站点访问')
        } else if(domain=='vercel-blog.admincmd.xyz') {
            console.log('由本站镜像站点访问') // 已弃用此域名
        } else if(domain=='netlify-blog.admincmd.xyz') {
            console.log('由本站镜像站点访问')
        } else if(domain=='cf-blog.admincmd.xyz') {
            console.log('由本站镜像站点访问')
        } else if(domain=='github-blog.admincmd.xyz') {
            console.log('由本站镜像站点访问')
        } else if (domain == 'www.travelling.cn') {
            // 康康是不是来自开往的
            Snackbar.show({
                text: '欢迎来自开往的穿梭者！',
                pos: 'top-center',
            })
        
        } else if (domain == ' ? ? ? ') { 
            console.log('由外部站点访问')
            if(domain==' ? ? ? ') {
                domain = pos;// 若来源为空，则使用定位信息
                Snackbar.show({
                    text: `欢迎从来自 ${domain} 的访客访问本站！`,
                    pos: 'top-center',
                    actionText: "",
                    onActionClick: function (element) {
                        window.open("")
                    },
                });
            } else {
                console.warn('');
                Snackbar.show({// 如果有
                    text: `欢迎从来自 ${domain} 的访客访问本站！`,
                    pos: 'top-center',
                    actionText: "",
                    onActionClick: function (element) {
                        window.open("")
                    },
                });
            }
        }
            
    },2500)
}


    // 如没有来源，则修改为？？？
    // if (document.referrer==undefined||document.referrer.indexOf("www.travellings.cn")!=-1||document.referrer.indexOf("www.travellings.cn")!=-1)
    //     { 
            
            
    //     } else {
        //     setTimeout(function () { // 康康是不是来自其他网站
        //         if(domain=='blog.admincmd.xyz') {
        //             console.log('由本站主站站点访问')
        //         } else if(domain=='vercel-blog.admincmd.xyz') {
        //             console.log('由本站镜像站点访问') // 已弃用此域名
        //         } else if(domain=='netlify-blog.admincmd.xyz') {
        //             console.log('由本站镜像站点访问')
        //         } else if(domain=='cf-blog.admincmd.xyz') {
        //             console.log('由本站镜像站点访问')
        //         } else if(domain=='github-blog.admincmd.xyz') {
        //             console.log('由本站镜像站点访问')
        //         } else if (domain == 'www.travelling.cn') {
        //             // 康康是不是来自开往的
        //             Snackbar.show({
        //                 text: '欢迎来自开往的穿梭者！',
        //                 pos: 'top-center',
        //             })
                
        //         } else if (domain == ' ? ? ? ') { 
        //             console.log('由外部站点访问')
        //             if(domain==' ? ? ? ') {
        //                 domain = pos;// 若来源为空，则使用定位信息
        //                 Snackbar.show({
        //                     text: `欢迎从来自 ${domain} 的访客访问本站！`,
        //                     pos: 'top-center',
        //                     actionText: "",
        //                     onActionClick: function (element) {
        //                         window.open("")
        //                     },
        //                 });
        //             } else {
        //                 console.warn('');
        //                 Snackbar.show({// 如果有
        //                     text: `欢迎从来自 ${domain} 的访客访问本站！`,
        //                     pos: 'top-center',
        //                     actionText: "",
        //                     onActionClick: function (element) {
        //                         window.open("")
        //                     },
        //                 });
        //             }
    
        //             }
                    
        //     },2500)
        // }
    
// }

//自带上文浏览器提示

function browserTC() {
    btf.snackbarShow("");
    Snackbar.show({
        text: '浏览器版本较低，网站样式可能错乱',
        actionText: 'OK',
        duration: '16000',
        pos: 'bottom-right'
    });
}
function browserVersion() {
    var userAgent = navigator.userAgent; //取得浏览器的userAgent字符串
    var isIE = userAgent.indexOf("compatible") > -1 && userAgent.indexOf("MSIE") > -1; //判断是否IE<11浏览器
    var isIE11 = userAgent.indexOf('Trident') > -1 && userAgent.indexOf("rv:11.0") > -1;
    var isEdge = userAgent.indexOf("Edge") > -1 && !isIE; //Edge浏览器
    var isFirefox = userAgent.indexOf("Firefox") > -1; //Firefox浏览器
    var isOpera = userAgent.indexOf("Opera")>-1 || userAgent.indexOf("OPR")>-1 ; //Opera浏览器
    var isChrome = userAgent.indexOf("Chrome")>-1 && userAgent.indexOf("Safari")>-1 && userAgent.indexOf("Edge")==-1 && userAgent.indexOf("OPR")==-1; //Chrome浏览器
    var isSafari = userAgent.indexOf("Safari")>-1 && userAgent.indexOf("Chrome")==-1 && userAgent.indexOf("Edge")==-1 && userAgent.indexOf("OPR")==-1; //Safari浏览器
    if(isEdge) {
        if(userAgent.split('Edge/')[1].split('.')[0]<90){
            browserTC()
        }
    } else if(isFirefox) {
        if(userAgent.split('Firefox/')[1].split('.')[0]<90){
            browserTC()
        }
    } else if(isOpera) {
        if(userAgent.split('OPR/')[1].split('.')[0]<80){
            browserTC()
        }
    } else if(isChrome) {
        if(userAgent.split('Chrome/')[1].split('.')[0]<90){
            browserTC()
        }
    } else if(isSafari) {
        //不知道Safari哪个版本是该淘汰的老旧版本
    }
}
//2022-10-29修正了一个错误：过期时间应使用toGMTString()，而不是toUTCString()，否则实际过期时间在中国差了8小时
function setCookies(obj, limitTime) {
    let data = new Date(new Date().getTime() + limitTime * 24 * 60 * 60 * 1000).toGMTString()
    for (let i in obj) {
        document.cookie = i + '=' + obj[i] + ';expires=' + data
    }
}
function getCookie(name) {
    var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
    if (arr = document.cookie.match(reg))
        return unescape(arr[2]);
    else
        return null;
}
if(getCookie('browsertc')!=1){
    setCookies({
        browsertc: 1,
    }, 1);
    browserVersion();
}



// 右键菜单 
//--------------------------------------------------------------------------
//22.12.8 update：add mask
//22.12.9 update: add search in this page

// ------
function setMask(){//设置遮罩层
    if(document.getElementsByClassName("rmMask")[0]!=undefined){
        return document.getElementsByClassName("rmMask")[0];
    }
    mask = document.createElement('div');
    mask.className = "rmMask";
    mask.style.width = window.innerWidth + 'px';
    mask.style.height = window.innerHeight + 'px';
    mask.style.background = '#fff';
    mask.style.opacity = '.0';
    mask.style.position = 'fixed';
    mask.style.top = '0';
    mask.style.left = '0';
    mask.style.zIndex = 998;
    document.body.appendChild(mask);
    document.getElementById("rightMenu").style.zIndex=19198;
    return mask;
}

function insertAtCursor(myField, myValue) {

    //IE 浏览器
    if (document.selection) {
        myField.focus();
        sel = document.selection.createRange();
        sel.text = myValue;
        sel.select();
    }

    //FireFox、Chrome等
    else if (myField.selectionStart || myField.selectionStart == '0') {
        var startPos = myField.selectionStart;
        var endPos = myField.selectionEnd;

        // 保存滚动条
        var restoreTop = myField.scrollTop;
        myField.value = myField.value.substring(0, startPos) + myValue + myField.value.substring(endPos, myField.value.length);

        if (restoreTop > 0) {
            myField.scrollTop = restoreTop;
        }

        myField.focus();
        myField.selectionStart = startPos + myValue.length;
        myField.selectionEnd = startPos + myValue.length;
    } else {
        myField.value += myValue;
        myField.focus();
    }
}
let rmf = {};
rmf.showRightMenu = function (isTrue, x = 0, y = 0) {
    let $rightMenu = $('#rightMenu');
    $rightMenu.css('top', x + 'px').css('left', y + 'px');

    if (isTrue) {
        $rightMenu.show();
    } else {
        $rightMenu.hide();
    }
}
rmf.switchDarkMode = function () { // 切换暗黑模式，执行位置
    const nowMode = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light'
    if (nowMode === 'light') {
        SwichActivateDarkMode()
        saveToLocal.set('theme', 'dark', 2)
        GLOBAL_CONFIG.Snackbar !== undefined && btf.snackbarShow(GLOBAL_CONFIG.Snackbar.day_to_night)
    } else {
        SwitchActivateLightMode()
        saveToLocal.set('theme', 'light', 2)
        GLOBAL_CONFIG.Snackbar !== undefined && btf.snackbarShow(GLOBAL_CONFIG.Snackbar.night_to_day)
    }
    // handle some cases
    typeof utterancesTheme === 'function' && utterancesTheme()
    typeof FB === 'object' && window.loadFBComment()
    window.DISQUS && document.getElementById('disqus_thread').children.length && setTimeout(() => window.disqusReset(), 200)
};
rmf.yinyong=function(){
    var e = document.getElementsByClassName("el-textarea__inner")[0],
        t = document.createEvent("HTMLEvents");
    t.initEvent("input", !0, !0), e.value = d.value = "> "+getSelection().toString()+"\n\n", e.dispatchEvent(t);
    console.log(getSelection().toString());
    document.getElementsByClassName("el-textarea__inner")[0].value="> "+getSelection().toString()+"\n\n";
    Snackbar.show({
        text: '为保证最佳评论阅读体验，建议不要删除空行',
        pos: 'top-center',
        showAction: false,
    })
}
rmf.copyWordsLink = function () {
    let url = window.location.href
    let txa = document.createElement("textarea");
    txa.value = url;
    document.body.appendChild(txa)
    txa.select();
    document.execCommand("Copy");
    document.body.removeChild(txa);
    Snackbar.show({
        text: '链接复制成功！',
        pos: 'top-right',
        showAction: false
    });
}
rmf.switchReadMode = function () {
    const $body = document.body
    $body.classList.add('read-mode')
    const newEle = document.createElement('button')
    newEle.type = 'button'
    newEle.className = 'fas fa-sign-out-alt exit-readmode'
    $body.appendChild(newEle)

    function clickFn() {
        $body.classList.remove('read-mode')
        newEle.remove()
        newEle.removeEventListener('click', clickFn)
    }

    newEle.addEventListener('click', clickFn)
}

//复制选中文字
rmf.copySelect = function () {
    document.execCommand('Copy', false, null);
    Snackbar.show({
        text: '已占领剪贴板！',
        pos: 'top-right',
        showAction: false
    });
}

//回到顶部
rmf.scrollToTop = function () {
    document.getElementsByClassName("menus_items")[1].setAttribute("style","");
    document.getElementById("name-container").setAttribute("style","display:none");
    btf.scrollToDest(0, 500);
}
rmf.translate = function () {
    document.getElementById("translateLink").click();
}
rmf.searchinThisPage=()=>{
    document.body.removeChild(mask);
    document.getElementsByClassName("local-search-box--input")[0].value=window.getSelection().toString()
    document.getElementsByClassName("search")[0].click()
    var evt = document.createEvent("HTMLEvents");evt.initEvent("input", false, false);document.getElementsByClassName("local-search-box--input")[0].dispatchEvent(evt);
}
document.body.addEventListener('touchmove', function(e){
    
}, { passive: false });
function popupMenu() {
    //window.oncontextmenu=function(){return false;}
    window.oncontextmenu = function (event) {
        if(event.ctrlKey||document.body.clientWidth<900) return true;
        $('.rightMenu-group.hide').hide();
        if (document.getSelection().toString()) {
            $('#menu-text').show();
        }
        if (document.getElementById('post')) {
            $('#menu-post').show();
        } else {
            if (document.getElementById('page')) {
                $('#menu-post').show();
            }
        }
        var el = window.document.body;
        el = event.target;
        var a=/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\*\+,;=.]+$/
        if (a.test(window.getSelection().toString())&&el.tagName!="A"){
            $('#menu-too').show()
        }
        if (el.tagName == 'A') {
            $('#menu-to').show()
            rmf.open = function () {
                if(el.href.indexOf("http://")==-1&&el.href.indexOf("https://")==-1||el.href.indexOf("blog.admincmd.xyz")!=-1){
                    pjax.loadUrl(el.href)
                }
                else{
                    location.href = el.href
                }
            }
            rmf.openWithNewTab = function () {
                window.open(el.href);
                // window.location.reload();
            }
            rmf.copyLink = function () {
                let url = el.href
                let txa = document.createElement("textarea");
                txa.value = url;
                document.body.appendChild(txa)
                txa.select();
                document.execCommand("Copy");
                document.body.removeChild(txa);
            }
        }
        if (el.tagName == 'IMG') {
            $('#menu-img').show()
            rmf.openWithNewTab = function () {
                window.open(el.src);
                // window.location.reload();
            }
            rmf.click = function () {
                el.click()
            }
            rmf.copyLink = function () {
                let url = el.src
                let txa = document.createElement("textarea");
                txa.value = url;
                document.body.appendChild(txa)
                txa.select();
                document.execCommand("Copy");
                document.body.removeChild(txa);
            }
            rmf.saveAs=function(){
                var a = document.createElement('a');
                var url = el.src;
                var filename = url.split("/")[-1];
                a.href = url;
                a.download = filename;
                a.click();
                window.URL.revokeObjectURL(url);
            }
        } else if (el.tagName == "TEXTAREA" || el.tagName == "INPUT") {
            $('#menu-paste').show();
            // rmf.paste=function(){
            //     input.addEventListener('paste', async event => {
            //         event.preventDefault();
            //         const text = await navigator.clipboard.readText();
            //         el.value+=text;
            //       });
            // }
            rmf.paste = function () {
                navigator.permissions
                    .query({
                        name: 'clipboard-read'
                    })
                    .then(result => {
                        if (result.state == 'granted' || result.state == 'prompt') {
                            //读取剪贴板
                            navigator.clipboard.readText().then(text => {
                                console.log(text)
                                insertAtCursor(el, text)
                            })
                            Snackbar.show({
                                text: '粘贴成功！',
                                pos: 'top-right',
                                showAction: false
                            });
                        } else {
                            Snackbar.show({
                                text: 'ERROR: 读取剪贴板失败，请允许访问剪贴板！',
                                pos: 'top-center',
                                showAction: false,
                            })
                        }
                    })
            }
        }
        let pageX = event.clientX + 10;
        let pageY = event.clientY;
        let rmWidth = $('#rightMenu').width();
        let rmHeight = $('#rightMenu').height();
        if (pageX + rmWidth > window.innerWidth) {
            pageX -= rmWidth + 10;
        }
        if (pageY + rmHeight > window.innerHeight) {
            pageY -= pageY + rmHeight - window.innerHeight;
        }
        mask=setMask();
        window.onscroll=()=>{
            rmf.showRightMenu(false);
            window.onscroll=()=>{}
            document.body.removeChild(mask);
        }
        $(".rightMenu-item").click(()=>{
            document.body.removeChild(mask);
        })
        $(window).resize(()=>{
            rmf.showRightMenu(false);
            document.body.removeChild(mask);
        })
        mask.onclick=()=>{
            document.body.removeChild(mask);
        }
        rmf.showRightMenu(true, pageY, pageX);
        return false;
    };

    window.addEventListener('click', function () {
        rmf.showRightMenu(false);
    });
}
if (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))) {
    popupMenu()
}
const box = document.documentElement

function addLongtabListener(target, callback) {
    let timer = 0 // 初始化timer

    target.ontouchstart = () => {
        timer = 0 // 重置timer
        timer = setTimeout(() => {
            callback();
            timer = 0
        }, 380) // 超时器能成功执行，说明是长按
    }

    target.ontouchmove = () => {
        clearTimeout(timer) // 如果来到这里，说明是滑动
        timer = 0
    }

    target.ontouchend = () => { // 到这里如果timer有值，说明此触摸时间不足380ms，是点击
        if (timer) {
            clearTimeout(timer)
        }
    }
}

addLongtabListener(box, popupMenu)


// 明亮/暗黑模式切换
// -------------------------------------------------------------------------
function SwitchActivateLightMode() {
    activateLightMode()//调用 （浏览器）可能是的把，将调整至明亮模式
    sessionStorage.setItem("ActivateMode", "0"); //写个Cook
    LigheMode();
    // 将需要调整的元素修改代码扔在这里
// 调整至明亮模式
    //document.documentElement.setAttribute('data-theme', 'light')
    //document.documentElement.style.backgroundColor = '#fff'
}
function SwichActivateDarkMode() {
    activateDarkMode()
    sessionStorage.setItem("ActivateMode", "1");
    DarkMode();
    // 同上
    // 调整至暗黑模式
    //document.documentElement.setAttribute('data-theme', 'dark')
    //document.documentElement.style.backgroundColor = '#121212'
}

//页面加载后调用
if (sessionStorage.getItem("ActivateMode") == "1") {//检查cook，并判断是否为暗黑模式
    // 暗黑模式
    // 将需要调整的元素修改代码扔在这里
    DarkMode();
} else {
    // 明亮模式
    LigheMode();    
}


function LigheMode() {
    document.getElementById("travellings-logo").src = "https://www.travellings.cn/assets/b.png";
    

}


function DarkMode() {
    document.getElementById("travellings-logo").src = "https://www.travellings.cn/assets/w.png";
}

function justLookAround() {
    fetch('/sitemap.txt')
        .then(response => {
            if (!response.ok) {
                Snackbar.show({
                    text: '；；；；；；；；；；；；；；；；；；；；；；！',
                    pos: 'top-right',
                    showAction: false
                });
            }
            return response.text(); // 修正为 response
        })
        .then(data => {
            const lines = data.split('\n'); // 将文件内容按行拆分
            const randomIndex = Math.floor(Math.random() * lines.length); // 随机生成索引
            const randomLine = lines[randomIndex].trim(); // 获取随机行并去除多余空格

            if (randomLine) {
                window.location.href = randomLine; // 跳转到随机选择的链接
            } else {
                console.error('随机行为空，无法跳转。');
                Snackbar.show({
                    text: '跳转时出错: 1',
                    pos: 'top-right',
                    showAction: false
                });
            }
        })
        .catch(error => {
            console.error('读取 sitemap.txt 失败:', error);
            Snackbar.show({
                text: '跳转时出错: 2 \n' + error,
                pos: 'top-right',
                showAction: false
            });
        });
    
}





// 史山一坨


// const ap = new APlayer({
//     container: document.getElementById('aplayer'),
//     fixed: true,
//     audio: [{
//         name: "愿爱无忧",
//         artist: "恩几",
//         url: "file:///G:/XIAKE/鲍比达%20-%20菩提树.mp3",
//         cover: "",
//     }]
//  });